/*! jSmarty 2014-03-19 */
(function(e){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var r=module.exports||exports;e(r,"node")}else"function"==typeof define&&define.amd?define(["exports"],e):e(window.NC={})})(function(exports,env){function escapeRegExp(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function removeUnsafe(e){var r=e.replace(/([\r\n])/gi,"\\n").replace(/\s{2,}/gi," ").replace(/\'/gi,"\\'");return r}function phpToJSVar(e){return e.replace(/\$(([a-zA-Z_][a-zA-Z0-9_]*))(\.\[)*/gi,function(e,r){return r})}function number_format(e,r,t,a){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var n=isFinite(+e)?+e:0,i=isFinite(+r)?Math.abs(r):0,s=a===void 0?",":a,o=t===void 0?".":t,u="",p=function(e,r){var t=Math.pow(10,r);return""+Math.round(e*t)/t};return u=(i?p(n,i):""+Math.round(n)).split("."),u[0].length>3&&(u[0]=u[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,s)),i>(u[1]||"").length&&(u[1]=u[1]||"",u[1]+=Array(i-u[1].length+1).join("0")),u.join(o)}function fetch(e,r,t){var a,n="";a=fs.getContentText(e);for(var i=/<!--\s*template\s*-->([\s|\S]*?)<!--\s*\/template\s*-->/gi,s=a.match(i);s=i.exec(a);)n+=s[1];var n=filter.HTMLFilter(n,e,r,t);return n}function Parser(e,r){this._tokens=e,this._output="",this._vars=r||{}}var strftime=function(){function e(r,a){return(a+"").replace(/%([a-zA-Z ])/g,function(a,n){var i=t&&t[n];return"function"==typeof i?i.call(t,r):"string"==typeof i?e(i):n})}function r(e){return(10>+e?"0":"")+e}var t={d:function(e){return r(e.getDate())},m:function(e){return r(e.getMonth()+1)},y:function(e){return e.getYear()%100},Y:function(e){return e.getFullYear()},F:"%Y-%m-%d",D:"%m/%d/%y"};return e}(),nc=exports!==void 0?exports:{},fs,path,filter,util;"node"==env&&(fs=require("./file.js"),path=require("path"),filter=require("./pages.js"),util=require("./util.js"));var ObjProto=Object.prototype,toString=ObjProto.toString,reMarker=function(){this._tokens=[],this._included=[],this._basePath="",this._vars={}};reMarker.prototype.startTag="{",reMarker.prototype.endTag="}",reMarker.prototype.setBasePath=function(e){return this._basePath=e,this},reMarker.prototype.setIncluded=function(e){return this._included.push(e),this},reMarker.prototype.getIncluded=function(){return this._included},reMarker.prototype.parse=function(e){for(var r,t=escapeRegExp(this.startTag)+"(?:\\s*)((?:[\\/\\$])*[\\w\\*]+)(?:\\s*)(.*?)(?:\\1*)(?:\\s*)"+escapeRegExp(this.endTag),a=RegExp(t,"gim"),n=[],i=0;r=a.exec(e);)i!=r.index&&n.push({type:"text",value:e.substring(i,r.index),matched:e.substring(i,r.index),index:i}),n.push({type:"expression",expr:r[1],value:r[2],matched:r[0],index:r.index}),i=r.index+r[0].length;return n.push({type:"text",value:e.substring(i),matched:e.substring(i),index:i}),this.parser=new Parser(n,this._vars),this.parser.parse(this)},reMarker.prototype.proc=function(e,r){var t,a=this;try{this._vars=r;var n=this.parse(e);t=Function("$data","$util",n+';return _out.join("");')}catch(i){throw Error("模板解析出错"+i.message)}if(!r)return function(e){var r=a;return t(e,r)};var s=t.call(this,r,this);return s},reMarker.prototype.value=function(e){return"[object Object]"===toString.call(e)||"[object Array]"===toString.call(e)?JSON.stringify(e):e},nc.reMarker=reMarker;var VAR_REGEX=/\$(([a-zA-Z_][a-zA-Z0-9_]*)(\.[a-zA-Z_][a-zA-Z0-9_]*)*(\[[^\]]+\]*)*)/gi,ATTRI_REGEX=/(?:[\s]*(?:([^=\s]+?)\s*=\s*)?(?:(?:"([^"\\]*)"|'([^'\\]*)'|([^\s'"]+)+)))+?/gi;Parser.openEachTag=0,Parser.openLiteralTag=0,Parser.prototype.parse=function(e){this._reMarker=e||{},this._output="var _out=[];with($data){";for(var r=0;this._tokens.length>r;r++){var t=this._tokens[r];if("/literal"!=t.expr)if("text"==t.type||Parser.openLiteralTag>0)this._output+="_out.push('"+removeUnsafe(t.matched)+"');\r\n";else{var a=t.expr;a="elseif"==a?"if":a;var n=t.value;this._output+=this.functions[a]?this.functions[a].call(this,t.matched,this.getAttributes(n)):"_out.push($util.value("+phpToJSVar(a+t.value,Parser.openEachTag)+"));\r\n"}else this.functions[t.expr].call(this,n,this.getAttributes(n))}return this._output+="};",this._output},Parser.prototype.getAttributes=function(e){if(!e)return[];for(var r,t=0,a={};r=ATTRI_REGEX.exec(" "+e);){var n,i;r[1]===void 0?(n=t,i=r[0].replace(/^\s+|\s+$/g,""),t++):(n=r[1],i=r[2]||r[3]||r[4]),a[n]=i}return e=a},Parser.prototype.needSkip=function(e){var r=!1;switch(e){case"":case"index":case"input":case"__proto__":r=!0}return r},Parser.prototype.modifiers={date_format:function(e,r,t){if(!e&&!t)return"date_format语法错误";var a=e||t;"number"!=typeof a&&(a=strtotime(a,time()));var n=strftime(r||"%b %e %Y",a);return n},"default":function(e,r){return e||r},fsize_format:function(e,r,t){r=r||"",t=t||2;var a={TB:1099511627776,GB:1073741824,MB:1048576,KB:1024,B:1},n="";for(var i in a)if(e>a[i]||i==strtoupper(r)){n=number_format(e/a[i],t)+" "+i;break}return n}},Parser.prototype.functions={"*":function(){return""},"/foreach":function(){var e=[];return e.push("}/*for end*/}/*if end*/"),e.push("}();"),Parser.openEachTag--,e.join("\r\n")},include:function(content,attributes){if(void 0==attributes.file)return"include语法错误"+content;if("node"==env)return"include语法不被支持";var var_file,var_assign;for(var arg_name in attributes){var arg_value=attributes[arg_name];if("file"!=arg_name)if("assign"!=arg_name){if(0==arg_value.indexOf("$")){var nativeKey=phpToJSVar(arg_value,Parser.openEachTag);attributes[arg_name]=eval("this._vars."+nativeKey)}}else var_assign=arg_value;else var_file=arg_value,delete attributes[arg_name]}var url=path.normalize(path.join(this._reMarker._basePath,var_file)),content=fetch(url,this._reMarker._basePath,attributes);return this._reMarker.setIncluded(url),var_assign?(this._vars[var_assign]=content,"var "+var_assign+"='"+removeUnsafe(content)+"';"):"_out.push('"+removeUnsafe(content)+"');"},assign:function(e,r){if(r["var"]===void 0||r.value===void 0)return"assign语法错误"+e;var t=r.value;"[]"===t&&(t={});var a=r["var"].replace(/'|"/gi,"");return this._vars[a]=t,"var "+a+'="'+phpToJSVar(r.value,Parser.openEachTag)+'";'},foreachelse:function(){return"}}else{{"},foreach:function(e,r){var t=r.from,a=r.item;if(!t&&!a)return"assign语法错误"+e;var n=r.key||"k"+Math.round(1e4*Math.random()),i=r.name||Math.round(1e4*Math.random()),s=[];return s.push("~function(){"),s.push('if(Object.prototype.toString.call({$var})==="[object Array]" && {$var}.length>0){ '.replace(/\{\$var\}/gi,phpToJSVar(t,Parser.openEachTag))),s.push("var iter=0;var length = 0;for (var k in "+phpToJSVar(t,Parser.openEachTag)+") {++length;}"),s.push("for (var i in "+phpToJSVar(t,Parser.openEachTag)+") {"),s.push("var smarty={};smarty.foreach={};"),s.push('smarty.foreach["'+i+'"] ={};'),s.push('smarty.foreach["'+i+'"].index= iter;'),s.push('smarty.foreach["'+i+'"].iteration= iter+1;'),s.push('smarty.foreach["'+i+'"].first= iter==0;'),s.push('smarty.foreach["'+i+'"].last= iter==length-1;'),s.push('smarty.foreach["'+i+'"].total= length;'),s.push("var "+a+"= "+phpToJSVar(t,Parser.openEachTag)+"[i];"),n&&s.push(n+"= i;"),s.push("iter++;"),Parser.openEachTag++,s.join("\r\n")},"/if":function(){return"};"},"else":function(){return"}else{"},"if":function(e,r){var t,a,n,s,o,u,p="",c=function(){a="",n=!1,s="",o="",u="== 0"},f=function(){a=n?"("+a+s+") "+o+u:a,p+=a};c();for(i in r)if(!this.needSkip(i)&&(t=r[i],!this.needSkip(t)))switch(t){case"is":n=!0;break;case"not":u="== 0"===u?"!= 0":"== 0";break;case"div":break;case"even":o="% 2 ";break;case"odd":u="== 0"===u?"!= 0":"== 0",o="% 2 ";break;case"by":s+=" / ";break;case"||":case"&&":f(),p+=t+" ",c();break;default:this.operators[t]!==void 0?a+=this.operators[t]+" ":n?s+=t+" ":a+=phpToJSVar(t,Parser.openEachTag)+" "}f();var h="if("+p+"){";return e.match(/\{elseif\s+[^\}]*\}/i)&&(h="}else if("+p+"){"),h},literal:function(){return Parser.openLiteralTag++,""},"/literal":function(){return Parser.openLiteralTag--,""}},Parser.prototype.buildTagMatch=function(e,r){var t="";return e instanceof RegExp&&(e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e=e.source),t=t||r||"",RegExp(escapeRegExp(this._reMarker.startTag)+escapeRegExp(e)+escapeRegExp(this._reMarker.endTag),t)},Parser.prototype.operators={eq:"==",ne:"!=",neq:"!=",gt:">",lt:"<",ge:">=",gte:">=",le:"<=",lte:"<=",and:"&&",or:"||",mod:"%","==":"==","===":"===","!=":"!=",">":">","<":"<",">=":">=","<=":"<=","!":"!","%":"%","(":"(",")":")",0:0,"false":!1,"null":null,undefined:null}}),function(e){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var r=module.exports||exports;e(r)}else if("function"==typeof define&&define.amd)define(["exports"],e);else{for(var t=document.getElementsByTagName("script"),a=[],n=0;t.length>n;n++)"remark-template"==t[n].getAttribute("type")&&a.push(t[n]);for(var i=0;a.length>i;i++){var s="__"+a[i].id+"__";window[s]=(new window.NC.reMarker).proc(a[i].innerHTML)}}}(function(){});